exports.id = 0;
exports.modules = {

/***/ "./src/backend/socket/index.js":
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("Object.defineProperty(exports, \"__esModule\", { value: true });var _socket = __webpack_require__(\"socket.io\");var _socket2 = _interopRequireDefault(_socket);\nvar _models = __webpack_require__(\"./src/backend/models/index.js\");\nvar _Game = __webpack_require__(\"./src/backend/socket/Game.js\");var _Game2 = _interopRequireDefault(_Game);\nvar _Player = __webpack_require__(\"./src/backend/socket/Player.js\");var _Player2 = _interopRequireDefault(_Player);function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { default: obj };}\n\nvar connectSocket = function connectSocket(httpServer) {\n  var io = (0, _socket2.default)(httpServer, { path: '/socket' });\n  var games = [];\n  io.on('connection', function (socket) {\n    socket.on('AUTH', function (data) {var\n      token = data.token,auction_id = data.auction_id;\n      _models.Auth.verify(token).\n      then(function (auth) {return _models.Auth.populate(auth, 'user');}).\n      then(function (auth) {return auth.refresh();}).\n      then(function (auth) {\n        var author = auth.user.toJSON({ req: {} });\n        var game = games.find(function (game) {return !game.finished_at && game.findPlayer(author, function (player) {return !player.isDone();});});\n        if (!game) game = games.find(function (game) {return !game.started_at;});\n        if (!game) {\n          game = new _Game2.default(io, function () {\n            var index = games.indexOf(undefined);\n            if (~index) games.splice(index, 1);\n          });\n          games.push(game);\n        }\n        socket.join(game.room);\n\n        var player = game.findPlayer(author);\n        if (player) {\n          player.connect();\n        } else {\n          player = new _Player2.default(io, game, author);\n          game.addPlayer(player);\n        }\n\n        listenOnPlayer(player);\n      }).\n      catch(function (err) {\n        console.error(err);\n        socket.disconnect();\n      });\n    });\n\n    var listenOnPlayer = function listenOnPlayer(player) {\n      socket.on('disconnect', function () {\n        player.disconnect();\n      });\n      socket.on('START_TYPING', function () {\n        player.startTyping();\n      });\n      socket.on('STOP_TYPING', function () {\n        player.stopTyping();\n      });\n      socket.on('SUBMIT', function (code) {\n        player.submit(code);\n      });\n    };\n  });\n};exports.default =\n\nconnectSocket;//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvYmFja2VuZC9zb2NrZXQvaW5kZXguanMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvYmFja2VuZC9zb2NrZXQvaW5kZXguanM/NDc2ZSJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO3ZhciBfc29ja2V0ID0gcmVxdWlyZSgnc29ja2V0LmlvJyk7dmFyIF9zb2NrZXQyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfc29ja2V0KTtcbnZhciBfbW9kZWxzID0gcmVxdWlyZSgnL21vZGVscycpO1xudmFyIF9HYW1lID0gcmVxdWlyZSgnLi9HYW1lJyk7dmFyIF9HYW1lMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX0dhbWUpO1xudmFyIF9QbGF5ZXIgPSByZXF1aXJlKCcuL1BsYXllcicpO3ZhciBfUGxheWVyMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX1BsYXllcik7ZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHtyZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTt9XG5cbnZhciBjb25uZWN0U29ja2V0ID0gZnVuY3Rpb24gY29ubmVjdFNvY2tldChodHRwU2VydmVyKSB7XG4gIHZhciBpbyA9ICgwLCBfc29ja2V0Mi5kZWZhdWx0KShodHRwU2VydmVyLCB7IHBhdGg6ICcvc29ja2V0JyB9KTtcbiAgdmFyIGdhbWVzID0gW107XG4gIGlvLm9uKCdjb25uZWN0aW9uJywgZnVuY3Rpb24gKHNvY2tldCkge1xuICAgIHNvY2tldC5vbignQVVUSCcsIGZ1bmN0aW9uIChkYXRhKSB7dmFyXG4gICAgICB0b2tlbiA9IGRhdGEudG9rZW4sYXVjdGlvbl9pZCA9IGRhdGEuYXVjdGlvbl9pZDtcbiAgICAgIF9tb2RlbHMuQXV0aC52ZXJpZnkodG9rZW4pLlxuICAgICAgdGhlbihmdW5jdGlvbiAoYXV0aCkge3JldHVybiBfbW9kZWxzLkF1dGgucG9wdWxhdGUoYXV0aCwgJ3VzZXInKTt9KS5cbiAgICAgIHRoZW4oZnVuY3Rpb24gKGF1dGgpIHtyZXR1cm4gYXV0aC5yZWZyZXNoKCk7fSkuXG4gICAgICB0aGVuKGZ1bmN0aW9uIChhdXRoKSB7XG4gICAgICAgIHZhciBhdXRob3IgPSBhdXRoLnVzZXIudG9KU09OKHsgcmVxOiB7fSB9KTtcbiAgICAgICAgdmFyIGdhbWUgPSBnYW1lcy5maW5kKGZ1bmN0aW9uIChnYW1lKSB7cmV0dXJuICFnYW1lLmZpbmlzaGVkX2F0ICYmIGdhbWUuZmluZFBsYXllcihhdXRob3IsIGZ1bmN0aW9uIChwbGF5ZXIpIHtyZXR1cm4gIXBsYXllci5pc0RvbmUoKTt9KTt9KTtcbiAgICAgICAgaWYgKCFnYW1lKSBnYW1lID0gZ2FtZXMuZmluZChmdW5jdGlvbiAoZ2FtZSkge3JldHVybiAhZ2FtZS5zdGFydGVkX2F0O30pO1xuICAgICAgICBpZiAoIWdhbWUpIHtcbiAgICAgICAgICBnYW1lID0gbmV3IF9HYW1lMi5kZWZhdWx0KGlvLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgaW5kZXggPSBnYW1lcy5pbmRleE9mKHVuZGVmaW5lZCk7XG4gICAgICAgICAgICBpZiAofmluZGV4KSBnYW1lcy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIGdhbWVzLnB1c2goZ2FtZSk7XG4gICAgICAgIH1cbiAgICAgICAgc29ja2V0LmpvaW4oZ2FtZS5yb29tKTtcblxuICAgICAgICB2YXIgcGxheWVyID0gZ2FtZS5maW5kUGxheWVyKGF1dGhvcik7XG4gICAgICAgIGlmIChwbGF5ZXIpIHtcbiAgICAgICAgICBwbGF5ZXIuY29ubmVjdCgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHBsYXllciA9IG5ldyBfUGxheWVyMi5kZWZhdWx0KGlvLCBnYW1lLCBhdXRob3IpO1xuICAgICAgICAgIGdhbWUuYWRkUGxheWVyKHBsYXllcik7XG4gICAgICAgIH1cblxuICAgICAgICBsaXN0ZW5PblBsYXllcihwbGF5ZXIpO1xuICAgICAgfSkuXG4gICAgICBjYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgICAgc29ja2V0LmRpc2Nvbm5lY3QoKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgdmFyIGxpc3Rlbk9uUGxheWVyID0gZnVuY3Rpb24gbGlzdGVuT25QbGF5ZXIocGxheWVyKSB7XG4gICAgICBzb2NrZXQub24oJ2Rpc2Nvbm5lY3QnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHBsYXllci5kaXNjb25uZWN0KCk7XG4gICAgICB9KTtcbiAgICAgIHNvY2tldC5vbignU1RBUlRfVFlQSU5HJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBwbGF5ZXIuc3RhcnRUeXBpbmcoKTtcbiAgICAgIH0pO1xuICAgICAgc29ja2V0Lm9uKCdTVE9QX1RZUElORycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcGxheWVyLnN0b3BUeXBpbmcoKTtcbiAgICAgIH0pO1xuICAgICAgc29ja2V0Lm9uKCdTVUJNSVQnLCBmdW5jdGlvbiAoY29kZSkge1xuICAgICAgICBwbGF5ZXIuc3VibWl0KGNvZGUpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgfSk7XG59O2V4cG9ydHMuZGVmYXVsdCA9XG5cbmNvbm5lY3RTb2NrZXQ7XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9zcmMvYmFja2VuZC9zb2NrZXQvaW5kZXguanNcbi8vIG1vZHVsZSBpZCA9IC4vc3JjL2JhY2tlbmQvc29ja2V0L2luZGV4LmpzXG4vLyBtb2R1bGUgY2h1bmtzID0gMCJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/backend/socket/index.js\n");

/***/ })

};