exports.id = 0;
exports.modules = {

/***/ "./src/backend/controllers/image.js":
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("Object.defineProperty(exports, \"__esModule\", { value: true });var _express = __webpack_require__(\"express\");var _express2 = _interopRequireDefault(_express);\nvar _multer = __webpack_require__(\"multer\");var _multer2 = _interopRequireDefault(_multer);\nvar _models = __webpack_require__(\"./src/backend/models/index.js\");\nvar _config = __webpack_require__(\"./src/backend/common/config.js\");function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { default: obj };}\n\nvar router = _express2.default.Router();\n\nvar upload = (0, _multer2.default)({ dest: _config.imageUploadPaths.original }).single('image');\n\nvar addImage = function addImage(req, res, next) {var\n  file = req.file;\n  _models.Image.upload(file).\n  then(function (image) {return image.setAuthor(req.author).save();}).\n  then(function (image) {return res.return({ image: image });}).\n  catch(function (err) {\n    _models.Image.unlinkFiles(file.filename).catch(console.error);\n    next(err);\n  });\n};\n\nvar deleteImage = function deleteImage(req, res, next) {var\n  image_id = req.params.image_id;\n  _models.Image.get(image_id).\n  then(function (image) {return image.setAuthor(req.author).remove();}).\n  then(function (image) {return res.return({ image: image });}).\n  catch(next);\n};\n\nvar viewOriginalImage = function viewOriginalImage(req, res, next) {var\n  image_id = req.params.image_id;\n  _models.Image.get(image_id).\n  then(function (image) {\n    res.set('Content-type', image.mimeType);\n    return image.read(null);\n  }).\n  then(function (content) {return res.end(content);}).\n  catch(next);\n};\n\nvar viewThumbnailImage = function viewThumbnailImage(req, res, next) {var _req$params =\n  req.params,image_id = _req$params.image_id,image_size = _req$params.image_size;\n  _models.Image.get(image_id).\n  then(function (image) {\n    res.set('Content-type', image.mimeType);\n    return image.read(image_size);\n  }).\n  then(function (content) {return res.end(content);}).\n  catch(next);\n};\n\nrouter.route('/').\npost(upload, addImage);\n\nrouter.route('/:image_id').\ndelete(deleteImage);\n\nrouter.route('/:image_id/original').\nget(viewOriginalImage);\n\nrouter.route('/:image_id/thumbnail/:image_size').\nget(viewThumbnailImage);exports.default =\n\nrouter;//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvYmFja2VuZC9jb250cm9sbGVycy9pbWFnZS5qcy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9iYWNrZW5kL2NvbnRyb2xsZXJzL2ltYWdlLmpzP2RhYTciXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO09iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTt2YXIgX2V4cHJlc3MgPSByZXF1aXJlKCdleHByZXNzJyk7dmFyIF9leHByZXNzMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2V4cHJlc3MpO1xudmFyIF9tdWx0ZXIgPSByZXF1aXJlKCdtdWx0ZXInKTt2YXIgX211bHRlcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9tdWx0ZXIpO1xudmFyIF9tb2RlbHMgPSByZXF1aXJlKCcvbW9kZWxzJyk7XG52YXIgX2NvbmZpZyA9IHJlcXVpcmUoJy9jb21tb24vY29uZmlnJyk7ZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHtyZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTt9XG5cbnZhciByb3V0ZXIgPSBfZXhwcmVzczIuZGVmYXVsdC5Sb3V0ZXIoKTtcblxudmFyIHVwbG9hZCA9ICgwLCBfbXVsdGVyMi5kZWZhdWx0KSh7IGRlc3Q6IF9jb25maWcuaW1hZ2VVcGxvYWRQYXRocy5vcmlnaW5hbCB9KS5zaW5nbGUoJ2ltYWdlJyk7XG5cbnZhciBhZGRJbWFnZSA9IGZ1bmN0aW9uIGFkZEltYWdlKHJlcSwgcmVzLCBuZXh0KSB7dmFyXG4gIGZpbGUgPSByZXEuZmlsZTtcbiAgX21vZGVscy5JbWFnZS51cGxvYWQoZmlsZSkuXG4gIHRoZW4oZnVuY3Rpb24gKGltYWdlKSB7cmV0dXJuIGltYWdlLnNldEF1dGhvcihyZXEuYXV0aG9yKS5zYXZlKCk7fSkuXG4gIHRoZW4oZnVuY3Rpb24gKGltYWdlKSB7cmV0dXJuIHJlcy5yZXR1cm4oeyBpbWFnZTogaW1hZ2UgfSk7fSkuXG4gIGNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcbiAgICBfbW9kZWxzLkltYWdlLnVubGlua0ZpbGVzKGZpbGUuZmlsZW5hbWUpLmNhdGNoKGNvbnNvbGUuZXJyb3IpO1xuICAgIG5leHQoZXJyKTtcbiAgfSk7XG59O1xuXG52YXIgZGVsZXRlSW1hZ2UgPSBmdW5jdGlvbiBkZWxldGVJbWFnZShyZXEsIHJlcywgbmV4dCkge3ZhclxuICBpbWFnZV9pZCA9IHJlcS5wYXJhbXMuaW1hZ2VfaWQ7XG4gIF9tb2RlbHMuSW1hZ2UuZ2V0KGltYWdlX2lkKS5cbiAgdGhlbihmdW5jdGlvbiAoaW1hZ2UpIHtyZXR1cm4gaW1hZ2Uuc2V0QXV0aG9yKHJlcS5hdXRob3IpLnJlbW92ZSgpO30pLlxuICB0aGVuKGZ1bmN0aW9uIChpbWFnZSkge3JldHVybiByZXMucmV0dXJuKHsgaW1hZ2U6IGltYWdlIH0pO30pLlxuICBjYXRjaChuZXh0KTtcbn07XG5cbnZhciB2aWV3T3JpZ2luYWxJbWFnZSA9IGZ1bmN0aW9uIHZpZXdPcmlnaW5hbEltYWdlKHJlcSwgcmVzLCBuZXh0KSB7dmFyXG4gIGltYWdlX2lkID0gcmVxLnBhcmFtcy5pbWFnZV9pZDtcbiAgX21vZGVscy5JbWFnZS5nZXQoaW1hZ2VfaWQpLlxuICB0aGVuKGZ1bmN0aW9uIChpbWFnZSkge1xuICAgIHJlcy5zZXQoJ0NvbnRlbnQtdHlwZScsIGltYWdlLm1pbWVUeXBlKTtcbiAgICByZXR1cm4gaW1hZ2UucmVhZChudWxsKTtcbiAgfSkuXG4gIHRoZW4oZnVuY3Rpb24gKGNvbnRlbnQpIHtyZXR1cm4gcmVzLmVuZChjb250ZW50KTt9KS5cbiAgY2F0Y2gobmV4dCk7XG59O1xuXG52YXIgdmlld1RodW1ibmFpbEltYWdlID0gZnVuY3Rpb24gdmlld1RodW1ibmFpbEltYWdlKHJlcSwgcmVzLCBuZXh0KSB7dmFyIF9yZXEkcGFyYW1zID1cbiAgcmVxLnBhcmFtcyxpbWFnZV9pZCA9IF9yZXEkcGFyYW1zLmltYWdlX2lkLGltYWdlX3NpemUgPSBfcmVxJHBhcmFtcy5pbWFnZV9zaXplO1xuICBfbW9kZWxzLkltYWdlLmdldChpbWFnZV9pZCkuXG4gIHRoZW4oZnVuY3Rpb24gKGltYWdlKSB7XG4gICAgcmVzLnNldCgnQ29udGVudC10eXBlJywgaW1hZ2UubWltZVR5cGUpO1xuICAgIHJldHVybiBpbWFnZS5yZWFkKGltYWdlX3NpemUpO1xuICB9KS5cbiAgdGhlbihmdW5jdGlvbiAoY29udGVudCkge3JldHVybiByZXMuZW5kKGNvbnRlbnQpO30pLlxuICBjYXRjaChuZXh0KTtcbn07XG5cbnJvdXRlci5yb3V0ZSgnLycpLlxucG9zdCh1cGxvYWQsIGFkZEltYWdlKTtcblxucm91dGVyLnJvdXRlKCcvOmltYWdlX2lkJykuXG5kZWxldGUoZGVsZXRlSW1hZ2UpO1xuXG5yb3V0ZXIucm91dGUoJy86aW1hZ2VfaWQvb3JpZ2luYWwnKS5cbmdldCh2aWV3T3JpZ2luYWxJbWFnZSk7XG5cbnJvdXRlci5yb3V0ZSgnLzppbWFnZV9pZC90aHVtYm5haWwvOmltYWdlX3NpemUnKS5cbmdldCh2aWV3VGh1bWJuYWlsSW1hZ2UpO2V4cG9ydHMuZGVmYXVsdCA9XG5cbnJvdXRlcjtcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL3NyYy9iYWNrZW5kL2NvbnRyb2xsZXJzL2ltYWdlLmpzXG4vLyBtb2R1bGUgaWQgPSAuL3NyYy9iYWNrZW5kL2NvbnRyb2xsZXJzL2ltYWdlLmpzXG4vLyBtb2R1bGUgY2h1bmtzID0gMCJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/backend/controllers/image.js\n");

/***/ })

};