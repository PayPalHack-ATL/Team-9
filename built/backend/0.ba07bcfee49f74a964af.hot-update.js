exports.id = 0;
exports.modules = {

/***/ "./src/backend/controllers/image.js":
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("Object.defineProperty(exports, \"__esModule\", { value: true });var _express = __webpack_require__(\"express\");var _express2 = _interopRequireDefault(_express);\nvar _multer = __webpack_require__(\"multer\");var _multer2 = _interopRequireDefault(_multer);\nvar _models = __webpack_require__(\"./src/backend/models/index.js\");\nvar _config = __webpack_require__(\"./src/backend/common/config.js\");function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { default: obj };}\n\nvar router = _express2.default.Router();\n\nvar upload = (0, _multer2.default)({ dest: _config.imageUploadPaths.original }).single('image');\n\nvar addImage = function addImage(req, res, next) {\n  console.log(req.author.isUser);var\n  file = req.file;\n  _models.Image.upload(file).\n  then(function (image) {return image.setAuthor(req.author).save();}).\n  then(function (image) {return res.return({ image: image });}).\n  catch(function (err) {\n    _models.Image.unlinkFiles(file.filename).catch(console.error);\n    next(err);\n  });\n};\n\nvar deleteImage = function deleteImage(req, res, next) {var\n  image_id = req.params.image_id;\n  _models.Image.get(image_id).\n  then(function (image) {return image.setAuthor(req.author).remove();}).\n  then(function (image) {return res.return({ image: image });}).\n  catch(next);\n};\n\nvar viewOriginalImage = function viewOriginalImage(req, res, next) {var\n  image_id = req.params.image_id;\n  _models.Image.get(image_id).\n  then(function (image) {\n    res.set('Content-type', image.mimeType);\n    return image.read(null);\n  }).\n  then(function (content) {return res.end(content);}).\n  catch(next);\n};\n\nvar viewThumbnailImage = function viewThumbnailImage(req, res, next) {var _req$params =\n  req.params,image_id = _req$params.image_id,image_size = _req$params.image_size;\n  _models.Image.get(image_id).\n  then(function (image) {\n    res.set('Content-type', image.mimeType);\n    return image.read(image_size);\n  }).\n  then(function (content) {return res.end(content);}).\n  catch(next);\n};\n\nrouter.route('/').\npost(upload, addImage);\n\nrouter.route('/:image_id').\ndelete(deleteImage);\n\nrouter.route('/:image_id/original').\nget(viewOriginalImage);\n\nrouter.route('/:image_id/thumbnail/:image_size').\nget(viewThumbnailImage);exports.default =\n\nrouter;//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvYmFja2VuZC9jb250cm9sbGVycy9pbWFnZS5qcy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9iYWNrZW5kL2NvbnRyb2xsZXJzL2ltYWdlLmpzP2RhYTciXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO09iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTt2YXIgX2V4cHJlc3MgPSByZXF1aXJlKCdleHByZXNzJyk7dmFyIF9leHByZXNzMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2V4cHJlc3MpO1xudmFyIF9tdWx0ZXIgPSByZXF1aXJlKCdtdWx0ZXInKTt2YXIgX211bHRlcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9tdWx0ZXIpO1xudmFyIF9tb2RlbHMgPSByZXF1aXJlKCcvbW9kZWxzJyk7XG52YXIgX2NvbmZpZyA9IHJlcXVpcmUoJy9jb21tb24vY29uZmlnJyk7ZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHtyZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTt9XG5cbnZhciByb3V0ZXIgPSBfZXhwcmVzczIuZGVmYXVsdC5Sb3V0ZXIoKTtcblxudmFyIHVwbG9hZCA9ICgwLCBfbXVsdGVyMi5kZWZhdWx0KSh7IGRlc3Q6IF9jb25maWcuaW1hZ2VVcGxvYWRQYXRocy5vcmlnaW5hbCB9KS5zaW5nbGUoJ2ltYWdlJyk7XG5cbnZhciBhZGRJbWFnZSA9IGZ1bmN0aW9uIGFkZEltYWdlKHJlcSwgcmVzLCBuZXh0KSB7XG4gIGNvbnNvbGUubG9nKHJlcS5hdXRob3IuaXNVc2VyKTt2YXJcbiAgZmlsZSA9IHJlcS5maWxlO1xuICBfbW9kZWxzLkltYWdlLnVwbG9hZChmaWxlKS5cbiAgdGhlbihmdW5jdGlvbiAoaW1hZ2UpIHtyZXR1cm4gaW1hZ2Uuc2V0QXV0aG9yKHJlcS5hdXRob3IpLnNhdmUoKTt9KS5cbiAgdGhlbihmdW5jdGlvbiAoaW1hZ2UpIHtyZXR1cm4gcmVzLnJldHVybih7IGltYWdlOiBpbWFnZSB9KTt9KS5cbiAgY2F0Y2goZnVuY3Rpb24gKGVycikge1xuICAgIF9tb2RlbHMuSW1hZ2UudW5saW5rRmlsZXMoZmlsZS5maWxlbmFtZSkuY2F0Y2goY29uc29sZS5lcnJvcik7XG4gICAgbmV4dChlcnIpO1xuICB9KTtcbn07XG5cbnZhciBkZWxldGVJbWFnZSA9IGZ1bmN0aW9uIGRlbGV0ZUltYWdlKHJlcSwgcmVzLCBuZXh0KSB7dmFyXG4gIGltYWdlX2lkID0gcmVxLnBhcmFtcy5pbWFnZV9pZDtcbiAgX21vZGVscy5JbWFnZS5nZXQoaW1hZ2VfaWQpLlxuICB0aGVuKGZ1bmN0aW9uIChpbWFnZSkge3JldHVybiBpbWFnZS5zZXRBdXRob3IocmVxLmF1dGhvcikucmVtb3ZlKCk7fSkuXG4gIHRoZW4oZnVuY3Rpb24gKGltYWdlKSB7cmV0dXJuIHJlcy5yZXR1cm4oeyBpbWFnZTogaW1hZ2UgfSk7fSkuXG4gIGNhdGNoKG5leHQpO1xufTtcblxudmFyIHZpZXdPcmlnaW5hbEltYWdlID0gZnVuY3Rpb24gdmlld09yaWdpbmFsSW1hZ2UocmVxLCByZXMsIG5leHQpIHt2YXJcbiAgaW1hZ2VfaWQgPSByZXEucGFyYW1zLmltYWdlX2lkO1xuICBfbW9kZWxzLkltYWdlLmdldChpbWFnZV9pZCkuXG4gIHRoZW4oZnVuY3Rpb24gKGltYWdlKSB7XG4gICAgcmVzLnNldCgnQ29udGVudC10eXBlJywgaW1hZ2UubWltZVR5cGUpO1xuICAgIHJldHVybiBpbWFnZS5yZWFkKG51bGwpO1xuICB9KS5cbiAgdGhlbihmdW5jdGlvbiAoY29udGVudCkge3JldHVybiByZXMuZW5kKGNvbnRlbnQpO30pLlxuICBjYXRjaChuZXh0KTtcbn07XG5cbnZhciB2aWV3VGh1bWJuYWlsSW1hZ2UgPSBmdW5jdGlvbiB2aWV3VGh1bWJuYWlsSW1hZ2UocmVxLCByZXMsIG5leHQpIHt2YXIgX3JlcSRwYXJhbXMgPVxuICByZXEucGFyYW1zLGltYWdlX2lkID0gX3JlcSRwYXJhbXMuaW1hZ2VfaWQsaW1hZ2Vfc2l6ZSA9IF9yZXEkcGFyYW1zLmltYWdlX3NpemU7XG4gIF9tb2RlbHMuSW1hZ2UuZ2V0KGltYWdlX2lkKS5cbiAgdGhlbihmdW5jdGlvbiAoaW1hZ2UpIHtcbiAgICByZXMuc2V0KCdDb250ZW50LXR5cGUnLCBpbWFnZS5taW1lVHlwZSk7XG4gICAgcmV0dXJuIGltYWdlLnJlYWQoaW1hZ2Vfc2l6ZSk7XG4gIH0pLlxuICB0aGVuKGZ1bmN0aW9uIChjb250ZW50KSB7cmV0dXJuIHJlcy5lbmQoY29udGVudCk7fSkuXG4gIGNhdGNoKG5leHQpO1xufTtcblxucm91dGVyLnJvdXRlKCcvJykuXG5wb3N0KHVwbG9hZCwgYWRkSW1hZ2UpO1xuXG5yb3V0ZXIucm91dGUoJy86aW1hZ2VfaWQnKS5cbmRlbGV0ZShkZWxldGVJbWFnZSk7XG5cbnJvdXRlci5yb3V0ZSgnLzppbWFnZV9pZC9vcmlnaW5hbCcpLlxuZ2V0KHZpZXdPcmlnaW5hbEltYWdlKTtcblxucm91dGVyLnJvdXRlKCcvOmltYWdlX2lkL3RodW1ibmFpbC86aW1hZ2Vfc2l6ZScpLlxuZ2V0KHZpZXdUaHVtYm5haWxJbWFnZSk7ZXhwb3J0cy5kZWZhdWx0ID1cblxucm91dGVyO1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vc3JjL2JhY2tlbmQvY29udHJvbGxlcnMvaW1hZ2UuanNcbi8vIG1vZHVsZSBpZCA9IC4vc3JjL2JhY2tlbmQvY29udHJvbGxlcnMvaW1hZ2UuanNcbi8vIG1vZHVsZSBjaHVua3MgPSAwIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/backend/controllers/image.js\n");

/***/ })

};